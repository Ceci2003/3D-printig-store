---
import Layout from '../../../components/Layout.astro';
import SectionTitle from '../../../components/SectionTitle.astro';
import { getCollection, getEntry } from 'astro:content';

let settings = null;
try {
  settings = (await getEntry('site', 'settings')).data;
} catch (e) {
  // Settings not found, use defaults
}
const projects = await getCollection('projects');
const sortedProjects = projects.sort((a, b) => {
  const dateA = a.data.date?.getTime() || 0;
  const dateB = b.data.date?.getTime() || 0;
  return dateB - dateA;
});
---

<Layout title={`Галерия проекти - ${settings?.siteName || '3D Print Studio'}`}>

  <div class="container mx-auto px-4 py-8">
    <SectionTitle 
      title="Галерия проекти" 
      subtitle="Разгледайте нашите завършени проекти" 
    />

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {sortedProjects.map((project) => (
        <a
          href={`/services/gallery/${project.slug}`}
          class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
        >
          {project.data.images && project.data.images[0] ? (
            <img
              src={project.data.images[0].src}
              alt={project.data.images[0].alt || project.data.title}
              class="w-full h-48 object-cover"
              loading="lazy"
              onerror="this.src='/images/missing-photo.png'; this.onerror=null;"
            />
          ) : (
            <img
              src="/images/missing-photo.png"
              alt="Липсващо изображение"
              class="w-full h-48 object-cover"
              loading="lazy"
            />
          )}
          <div class="p-4">
            <h3 class="font-semibold text-lg mb-2">{project.data.title}</h3>
            <p class="text-gray-600 text-sm mb-3 line-clamp-2">{project.data.shortDescription}</p>
            {project.data.material && (
              <span class="inline-block bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded mb-2">
                {project.data.material}
              </span>
            )}
            {project.data.tags && project.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-1 mt-2">
                {project.data.tags.slice(0, 3).map(tag => (
                  <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </div>
        </a>
      ))}
    </div>
  </div>
</Layout>

